---
import IMoon from 'components/shared/Icons/IMoon.astro'
import ISun from 'components/shared/Icons/ISun.astro'
---

<div class="relative my-6 flex justify-end items-center space-x-2 lg:my-0">
  <label class="w-8 flex items-center bg-gray-100 rounded-xl" for="toggle_box">
    <input
      id="toggle_box"
      class="appearance-none peer"
      name="checkbox"
      type="checkbox"
    />

    <div class="absolute inset-0 z-[1] flex justify-between">
      <ISun className="scale-[0.8]" strokeColor="#333" />
      <IMoon className="scale-[0.8]" strokeColor="#333" />
    </div>

    <span
      class="relative z-[2] w-4 h-4 flex items-center rounded-2xl duration-300 ease-in-out cursor-pointer after:w-4 after:h-4 after:bg-teal after:rounded-2xl after:shadow-md after:duration-300 peer-checked:after:translate-x-4"
    >
    </span>
  </label>
</div>

<script>
  const checkbox = document.querySelector('#toggle_box') as HTMLInputElement
  const html = document.querySelector('html') as HTMLHtmlElement

  if (localStorage.getItem('darkmode') === 'true') {
    checkbox.checked = true
    html.classList.add('dark')
  }

  if (localStorage.getItem('darkmode') === 'false') {
    checkbox.checked = false
    html.classList.remove('dark')
  }

  const handleDarkmode = (e: MouseEvent) => {
    e.stopImmediatePropagation()

    localStorage.setItem('darkmode', `${checkbox.checked}`)

    if (checkbox.checked) {
      html.classList.add('dark')
    } else {
      html.classList.remove('dark')
    }
  }

  checkbox.addEventListener('click', handleDarkmode)
</script>
